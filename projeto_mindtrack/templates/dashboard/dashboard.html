{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- HEADER -->
<header>
    <div class="logo">
        Mind<span>Track</span>
    </div>
    <nav>
        <a href="#">P√°gina Inicial</a>
        <a href="#">Question√°rio</a>

    </nav>
    <div class="icon">
        <i class="fas fa-user"></i> <!-- √çcone de usu√°rio -->
    </div>
</header>

<!-- CONTE√öDO DO DASHBOARD -->
<div class="dashboard-container">
    <h1>Ol√°, {{ usuario.nome }}! üëã</h1>

    <section class="metrics-section">
        <h2>Filtros</h2>
        <form method="POST" class="filtro-form">
            {% csrf_token %}
            <div class="filtro-grid">
                <div class="filtro-item">
                    <label for="data_inicio">Data In√≠cio:</label>
                    <input type="date" name="data_inicio" id="data_inicio" value="{{ filtros.data_inicio }}">
                </div>
                <div class="filtro-item">
                    <label for="data_fim">Data Fim:</label>
                    <input type="date" name="data_fim" id="data_fim" value="{{ filtros.data_fim }}">
                </div>
                <div class="filtro-item">
                    <label for="idade_min">Idade M√≠nima:</label>
                    <input type="number" name="idade_min" id="idade_min" min="0" value="{{ filtros.idade_min }}">
                </div>
                <div class="filtro-item">
                    <label for="idade_max">Idade M√°xima:</label>
                    <input type="number" name="idade_max" id="idade_max" min="0" value="{{ filtros.idade_max }}">
                </div>
                <div class="filtro-item">
                    <label for="sexo">G√™nero:</label>
                    <select name="sexo" id="sexo">
                        <option value="">Todos</option>
                        <option value="M" {% if filtros.sexo == "Masculino" %}selected{% endif %}>Masculino</option>
                        <option value="F" {% if filtros.sexo == "Feminino" %}selected{% endif %}>Feminino</option>
                        <option value="O" {% if filtros.sexo == "Outro" %}selected{% endif %}>Outro</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="botao-filtro">Aplicar Filtros</button>
        </form>
    </section>

    <section class="metrics-section">
        <h2>M√©tricas Individuais</h2>
        <ul>
            <li><strong>Somat√≥rio de Pontua√ß√£o:</strong> {{ total_pontuacao_usuario }}</li>
            <li><strong>M√©dia de Pontua√ß√£o:</strong> {{ media_pontuacao_usuario }}</li>
            <li><strong>Interpreta√ß√£o:</strong> {{ interpretacao_usuario }}</li>
            <li><strong>Sem transtorno:</strong> {{ respostas_sem_transtorno }} respostas</li>
            <li><strong>Com transtorno:</strong> {{ respostas_com_transtorno }} respostas</li>
        </ul>
    </section>

    <section class="metrics-section">
        <h2>M√©tricas Gerais</h2>
        <ul>
            <li><strong>M√©dia Geral de Pontua√ß√£o:</strong> {{ media_pontuacao_geral }}</li>
            <li><strong>Percentual com Potencial Transtorno:</strong> {{ percentual_transtorno }}%</li>
            <li><strong>Total de Usu√°rios:</strong> {{ total_usuarios }}</li>
            <li><strong>Faixa Et√°ria:</strong> {{ idade_min }} - {{ idade_max }} anos</li>
        </ul>
    </section>

    <section class="metrics-section">
        <h2>Hist√≥rico de Resultados</h2>
        <table class="historico-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Pontua√ß√£o</th>
                    <th>Estratifica√ß√£o</th>
                </tr>
            </thead>
            <tbody>
                {% for resultado in historico_resultados %}
                <tr>
                    <td>{{ resultado.formulario.data_resposta }}</td>
                    <td>{{ resultado.pontuacao }}</td>
                    <td>{{ resultado.estratificacao }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3">Nenhum resultado encontrado.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <section class="metrics-section">
        <h2>Distribui√ß√£o Gr√°fica</h2>
        <canvas id="graficoDistribuicao" width="400" height="200"></canvas>
    </section>
</div>

<script>
    const ctx = document.getElementById('graficoDistribuicao').getContext('2d');
    const graficoDistribuicao = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Sem transtorno', 'Com transtorno'],
            datasets: [{
                label: 'Distribui√ß√£o',
                data: [{{ respostas_sem_transtorno }}, {{ respostas_com_transtorno }}],
                backgroundColor: ['#ffcc80', '#ff9800'],
                borderColor: ['#ffa726', '#fb8c00'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#555',
                        font: {
                            size: 14
                        }
                    }
                }
            }
        }
    });
</script>

</body>
</html>
